---
title: 'Introducing mlr3cluster: Cluster Analysis Package'
author: Damir Pulatov
date: '2020-08-14'
slug: mlr3cluster,tutorial,cluster
categories: 
  - R
tags:
  - mlr3
  - mlr3cluster
  - cluster analysis
  - tutorial
output:
blogdown::html_page:
  toc: true
---



<p>Tired of learning to use multiple packages to access clustering algorithms?</p>
<p>Using different packages makes it difficult to compare the performance of
clusterers?</p>
<p>It would be great to have just one package that makes interfacing
all things clustering easy?</p>
<p><a href="https://github.com/mlr-org/mlr3cluster">mlr3cluster</a> to the rescue!</p>
<p>mlr3cluster is a cluster analysis extention package within mlr3 library. It is
a successsor of mlr’s cluster capabilities in spirit and functionality.</p>
<p>In order to understand the following mini-tutorial you need to be already
familiar with R6 and basics of mlr3.
See the <a href="https://mlr3book.mlr-org.com/">mlr3book (chapters 1-2)</a> if you need a refresher.</p>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>To install the package, run the following code chunk:</p>
<pre class="r"><code>devtools::install_github(&quot;https://github.com/mlr-org/mlr3cluster&quot;)</code></pre>
</div>
<div id="getting-started" class="section level2">
<h2>Getting Started</h2>
<p>Assuming you know all the basics and you’ve installed the package,
here’s an example on how to perform k-means clustering on a classic <a href="https://stat.ethz.ch/R-manual/R-patched/library/datasets/html/USArrests.html">usarrests</a> data set:</p>
<pre class="r"><code>library(mlr3)
library(mlr3cluster)

task = mlr_tasks$get(&quot;usarrests&quot;)
learner = mlr_learners$get(&quot;clust.kmeans&quot;)
learner$train(task)
preds = learner$predict(task = task)

preds</code></pre>
<pre><code>## &lt;PredictionClust&gt; for 50 observations:
##     row_id partition
##          1         1
##          2         1
##          3         1
## ---                 
##         48         2
##         49         2
##         50         2</code></pre>
</div>
<div id="integrated-learners" class="section level2">
<h2>Integrated Learners</h2>
<p>List of integrated learners:</p>
<pre class="r"><code>mlr_learners$keys(&quot;clust&quot;)</code></pre>
<pre><code>## [1] &quot;clust.agnes&quot;       &quot;clust.cmeans&quot;      &quot;clust.dbscan&quot;     
## [4] &quot;clust.diana&quot;       &quot;clust.fanny&quot;       &quot;clust.featureless&quot;
## [7] &quot;clust.kmeans&quot;      &quot;clust.pam&quot;         &quot;clust.xmeans&quot;</code></pre>
<p>The package contains all the basic types of clustering: partitional, hierarchial, density-based and fuzzy.
Below is a detailed list of all the integrated learners.</p>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="left">Learner</th>
<th align="left">Package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.agnes.html">clust.agnes</a></td>
<td align="left">Agglomerative Hierarchical Clustering</td>
<td align="left"><a href="https://CRAN.R-project.org/package=cluster">cluster</a></td>
</tr>
<tr class="even">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.cmeans.html">clust.cmeans</a></td>
<td align="left">Fuzzy C-Means Clustering</td>
<td align="left"><a href="https://CRAN.R-project.org/package=e1071">e1071</a></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.dbscan.html">clust.dbscan</a></td>
<td align="left">Density-based Clustering</td>
<td align="left"><a href="https://CRAN.R-project.org/package=dbscan">dbscan</a></td>
</tr>
<tr class="even">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.diana.html">clust.diana</a></td>
<td align="left">Divisive Hierarchical Clustering</td>
<td align="left"><a href="https://CRAN.R-project.org/package=cluster">cluster</a></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.fanny.html">clust.fanny</a></td>
<td align="left">Fuzzy Clustering</td>
<td align="left"><a href="https://CRAN.R-project.org/package=cluster">cluster</a></td>
</tr>
<tr class="even">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.featureless.html">clust.featureless</a></td>
<td align="left">Simple Featureless Clustering</td>
<td align="left"><a href="https://github.com/mlr-org/mlr3cluster">mlr3cluster</a></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.kmeans.html">clust.kmeans</a></td>
<td align="left">K-Means Clustering</td>
<td align="left"><a href="https://CRAN.R-project.org/package=stats">stats</a></td>
</tr>
<tr class="even">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.pam.html">clust.pam</a></td>
<td align="left">Clustering Around Medoids</td>
<td align="left"><a href="https://CRAN.R-project.org/package=cluster">cluster</a></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_learners_clust.xmeans.html">clust.xmeans</a></td>
<td align="left">K-Means with Automatic Determination of k</td>
<td align="left"><a href="https://CRAN.R-project.org/package=RWeka">RWeka</a></td>
</tr>
</tbody>
</table>
</div>
<div id="integrated-measures" class="section level2">
<h2>Integrated Measures</h2>
<p>List of integrated cluster measures:</p>
<pre class="r"><code>mlr_measures$keys(&quot;clust&quot;)</code></pre>
<pre><code>## [1] &quot;clust.ch&quot;         &quot;clust.db&quot;         &quot;clust.dunn&quot;      
## [4] &quot;clust.silhouette&quot;</code></pre>
<p>Below is a detailed list of all the integrated learners.
look at clust.hb again to make sure name is correct. needs to be ch?</p>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="left">Measure</th>
<th align="left">Package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_measures_clust.db.html">clust.db</a></td>
<td align="left">Davies-Bouldin Cluster Separation</td>
<td align="left"><a href="https://CRAN.R-project.org/package=clusterCrit">clusterCrit</a></td>
</tr>
<tr class="even">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_measures_clust.dunn.html">clust.dunn</a></td>
<td align="left">Dunn index</td>
<td align="left"><a href="https://CRAN.R-project.org/package=clusterCrit">clusterCrit</a></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_measures_clust.ch.html">clust.ch</a></td>
<td align="left">Calinski Harabasz Pseudo F-Statistic</td>
<td align="left"><a href="https://CRAN.R-project.org/package=clusterCrit">clusterCrit</a></td>
</tr>
<tr class="even">
<td align="left"><a href="https://mlr-org.github.io/mlr3cluster/reference/mlr_measures_clust.silhouette.html">clust.silhouette</a></td>
<td align="left">Rousseeuw’s Silhouette Quality Index</td>
<td align="left"><a href="https://CRAN.R-project.org/package=clusterCrit">clusterCrit</a></td>
</tr>
</tbody>
</table>
</div>
<div id="integrated-tasks" class="section level2">
<h2>Integrated Tasks</h2>
<p>There is only one built-in Task in the package:</p>
<pre class="r"><code>mlr_tasks$get(&quot;usarrests&quot;)</code></pre>
<pre><code>## &lt;TaskClust:usarrests&gt; (50 x 4)
## * Target: -
## * Properties: -
## * Features (4):
##   - int (2): Assault, UrbanPop
##   - dbl (2): Murder, Rape</code></pre>
<p>As you can see, the biggest difference in clustering tasks and the rest of the tasks in mlr3 is the absense of the Target column.</p>
</div>
<div id="hyperparameters" class="section level2">
<h2>Hyperparameters</h2>
<p>Setting hyperparameters for clusterers is as easy as setting parameters for any other mlr3 learner:</p>
<pre class="r"><code>task = mlr_tasks$get(&quot;usarrests&quot;)
learner = mlr_learners$get(&quot;clust.kmeans&quot;)
learner$param_set</code></pre>
<pre><code>## &lt;ParamSet&gt;
##           id    class lower upper                             levels
## 1:   centers ParamUty    NA    NA                                   
## 2:  iter.max ParamInt     1   Inf                                   
## 3: algorithm ParamFct    NA    NA Hartigan-Wong,Lloyd,Forgy,MacQueen
## 4:    nstart ParamInt     1   Inf                                   
## 5:     trace ParamInt     0   Inf                                   
##          default         value
## 1:             2             2
## 2:            10            10
## 3: Hartigan-Wong Hartigan-Wong
## 4:             1              
## 5:             0             0</code></pre>
<pre class="r"><code>learner$param_set$values = list(centers = 3L, algorithm = &quot;Lloyd&quot;, iter.max = 100L)</code></pre>
</div>
<div id="train-and-predict" class="section level2">
<h2>Train and Predict</h2>
<p>The “train” method is simply creating a model with cluster assignments for data, while
the “predict” method’s functionality varies depending on the clusterer in use.
Read the documentation for more information.</p>
<p>In the case of <code>kmeans</code> clusterer, the predict method is using <code>clue::cl_predict</code> which performs cluster assignments for new data.</p>
<p>Following the example from the previous section:</p>
<pre class="r"><code>train_set = sample(task$nrow, 0.8 * task$nrow)
test_set = setdiff(seq_len(task$nrow), train_set)
learner$train(task, row_ids = train_set)
preds = learner$predict(task, row_ids = test_set)
preds</code></pre>
<pre><code>## &lt;PredictionClust&gt; for 10 observations:
##     row_id partition
##          2         2
##          7         3
##         12         3
## ---                 
##         37         1
##         40         2
##         49         3</code></pre>
</div>
<div id="evaluation" class="section level2">
<h2>Evaluation</h2>
<p>Below is an example how to use built-in measures to access the quality of clustering assignment</p>
<pre class="r"><code>measure = mlr_measures$get(&quot;clust.silhouette&quot;)
preds$score(measure, task)</code></pre>
<pre><code>## clust.silhouette 
##        0.5745265</code></pre>
</div>
<div id="visualization" class="section level2">
<h2>Visualization</h2>
<p>How do you visualize the tasks and the results of clustering experiments?
The <code>mlr3viz</code> package now provides functionality to visualize cluster analysis.</p>
<p>First, install <a href="https://github.com/damirpolat/mlr3viz/tree/cluster">mlr3viz</a> from a forked repository (still work in progress).</p>
<pre class="r"><code>devtools::install_github(&quot;https://github.com/damirpolat/mlr3viz/tree/cluster&quot;)</code></pre>
<pre class="r"><code>library(mlr3cluster)
library(mlr3viz)

task = mlr_tasks$get(&quot;usarrests&quot;)
learner = mlr_learners$get(&quot;clust.kmeans&quot;)
learner$param_set$values = list(centers = 3L)
learner$train(task)
preds = learner$predict(task)

autoplot(task)</code></pre>
<p><img src="/docs/2020-08-14-introducing-mlr3cluster-cluster-analysis-package_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code># Pairs plot with cluster assignments
autoplot(preds, task)</code></pre>
<p><img src="/docs/2020-08-14-introducing-mlr3cluster-cluster-analysis-package_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code># Silhouette plot with mean silhouette value as reference line
autoplot(preds, task, type = &quot;sil&quot;)</code></pre>
<p><img src="/docs/2020-08-14-introducing-mlr3cluster-cluster-analysis-package_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<pre class="r"><code># Performing PCA on task data and showing cluster assignments
autoplot(preds, task, type = &quot;pca&quot;)</code></pre>
<p><img src="/docs/2020-08-14-introducing-mlr3cluster-cluster-analysis-package_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
<p>Keep in mind that <code>mlr3viz::autoplot</code> also provides more options depending on the kind of plots you’re interested in.
For example, to draw borders around clusters, provide the appropriate parameters from <code>ggfortify::autoplot.kmeans</code>:</p>
<pre class="r"><code>autoplot(preds, task, type = &quot;pca&quot;, frame = TRUE)</code></pre>
<p><img src="/docs/2020-08-14-introducing-mlr3cluster-cluster-analysis-package_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>You can also easily visualize dendrograms:</p>
<pre class="r"><code>library(mlr3cluster)
library(mlr3viz)

task = mlr_tasks$get(&quot;usarrests&quot;)
learner = mlr_learners$get(&quot;clust.agnes&quot;)
learner$train(task)</code></pre>
</div>
<div id="acknowledgements" class="section level2">
<h2>Acknowledgements</h2>
<p>I would like to thank the following people for their help and guidance:
Michel Lang, Lars Kotthoff, Martin Binder, Patrick Schratz, Bernd Bischl.</p>
</div>
