---
title: 'Introducing mlr3cluster: Cluster Analysis Package'
author: Damir Pulatov
date: '2020-08-14'
slug: mlr3cluster,tutorial,cluster
categories: 
  - R
tags:
  - mlr3
  - mlr3cluster
  - cluster analysis
  - tutorial
output:
blogdown::html_page:
  toc: true
---

Tired of learning to use multiple packages to access clustering algorithms? 

Using different packages makes it difficult to compare the performance of 
clusterers?

It would be great to have just one package that makes interfacing 
all things clustering easy? 

[mlr3cluster](https://github.com/mlr-org/mlr3cluster) to the rescue!

mlr3cluster is a cluster analysis extention package within mlr3 library. It is 
a successsor of mlr's cluster capabilities in spirit and functionality. 

In order to understand the following mini-tutorial you need to be already 
familiar with R6 and basics of mlr3. See the [mlr3book (chapters 1-2)](https://mlr3book.mlr-org.com/)
if you need a refresher. 

## Installation
To install the package, run the following code chunk:

```{r echo = TRUE, results = FALSE, message = FALSE, warning = FALSE}
devtools::install_github("https://github.com/mlr-org/mlr3cluster")
```

## Getting Started

Assuming you know all the basics and you've installed the package, 
here's an example on how to perform k-means clustering on a classic [usarrests](https://stat.ethz.ch/R-manual/R-patched/library/datasets/html/USArrests.html) data set:

```{r intro}
library(mlr3)
library(mlr3cluster)

task = mlr_tasks$get("usarrests")
learner = mlr_learners$get("clust.kmeans")
learner$train(task)
preds = learner$predict(task = task)

preds
```

## Integrated Learners

List of integrated learners:

```{r}
mlr_learners$keys("clust")
```

The package contains all the basic types of clustering: partitional, 
hierarchial, density-based and fuzzy. Below is a detailed list of all the integrated learners.

| ID | Learner | Package |
| :--| :------ | :------ |
| [clust.agnes](https://mlr3cluster.mlr-org.com/reference/LearnerClustAgnes.html) | Agglomerative Hierarchical Clustering |  [cluster](https://CRAN.R-project.org/package=cluster) |
| [clust.cmeans](https://mlr3cluster.mlr-org.com/reference/LearnerClustCMeans.html) | Fuzzy C-Means Clustering |  [e1071](https://CRAN.R-project.org/package=e1071) |
| [clust.dbscan](https://mlr3cluster.mlr-org.com/reference/LearnerClustDBSCAN.html) | Density-based Clustering | [dbscan](https://CRAN.R-project.org/package=dbscan) |
| [clust.diana](https://mlr3cluster.mlr-org.com/reference/LearnerClustDiana.html) | Divisive Hierarchical Clustering | [cluster](https://CRAN.R-project.org/package=cluster) |
| [clust.fanny](https://mlr3cluster.mlr-org.com/reference/LearnerClustFanny.html) | Fuzzy Clustering | [cluster](https://CRAN.R-project.org/package=cluster) |
| [clust.featureless](https://mlr3cluster.mlr-org.com/reference/LearnerClustFeatureless.html) | Simple Featureless Clustering | [mlr3cluster](https://github.com/mlr-org/mlr3cluster) |
| [clust.kmeans](https://mlr3cluster.mlr-org.com/reference/LearnerClustKMeans.html) | K-Means Clustering | [stats](https://CRAN.R-project.org/package=stats) | 
| [clust.pam](https://mlr3cluster.mlr-org.com/reference/LearnerClustPAM.html) | Clustering Around Medoids | [cluster](https://CRAN.R-project.org/package=cluster) |
| [clust.xmeans](https://mlr3cluster.mlr-org.com/reference/LearnerClustXMeans.html) | K-Means with Automatic Determination of k | [RWeka](https://CRAN.R-project.org/package=RWeka) |


## Integrated Measures

List of integrated cluster measures: 

```{r}
mlr_measures$keys("clust")
```

Below is a detailed list of all the integrated learners.
look at clust.hb again to make sure name is correct. needs to be ch?

| ID | Measure | Package |
| :--| :------ | :------ |
| [clust.db](https://mlr3cluster.mlr-org.com/reference/MeasureClustInternal.html) | Davies-Bouldin Cluster Separation | [clusterCrit](https://CRAN.R-project.org/package=clusterCrit) |
| [clust.dunn](https://mlr3cluster.mlr-org.com/reference/MeasureClustInternal.html) | Dunn index | [clusterCrit](https://CRAN.R-project.org/package=clusterCrit) |
| [clust.ch](https://mlr3proba.mlr-org.com/reference/MeasureSurvCalibrationBeta.html) | Calinski Harabasz Pseudo F-Statistic | [clusterCrit](https://CRAN.R-project.org/package=clusterCrit) |
  | [clust.silhouette](https://mlr3cluster.mlr-org.com/reference/MeasureClustInternal.html) | Rousseeuw's Silhouette Quality Index | [clusterCrit](https://CRAN.R-project.org/package=clusterCrit) |


## Integrated Tasks

There is only one built-in Task in the package:

```{r}
mlr_tasks$get("usarrests")
```

As you can see, the biggest difference in clustering tasks and the rest of the 
tasks in mlr3 is the absense of the Target column. 


## Hyperparameters

Setting hyperparameters for clusterers is as easy as setting parameters for 
any other mlr3 learner: 

```{r hyperparam}
task = mlr_tasks$get("usarrests")
learner = mlr_learners$get("clust.kmeans")
learner$param_set
learner$param_set$values = list(centers = 3L, algorithm = "Lloyd", iter.max = 100L)
```


## Train and Predict
The "train" method is simply creating a model with cluster assignments for data, while 
the "predict" method's functionality varies depending on the clusterer in use. Read the documentation for 
more information. 

In the case of `kmeans` clusterer, the predict method is using `clue::cl_predict`  
which performs cluster assignments for new data. 

Following the example from the previous section:

```{r preds}
train_set = sample(task$nrow, 0.8 * task$nrow)
test_set = setdiff(seq_len(task$nrow), train_set)
learner$train(task, row_ids = train_set)
preds = learner$predict(task, row_ids = test_set)
```

## Evaluation

Below is an example how to use built-in measures to access the quality of clustering assignment 

```{r}
measure = mlr_measures$get("clust.silhouette")
preds$score(measure, task)
```

  
## Visualization

(might be revised)
A picture is worth a thousand words. How do you visualize the data and the results? 
I've added additional plots to mlr3viz which help with this task. Visualizing the results 
from the previous section:

```{r echo = TRUE, results = FALSE, message = FALSE, warning = FALSE}
library(mlr3viz)
autoplot(task)

autoplot(preds, task)

#autoplot(preds, task, type = "sil")
```


## Acknowledgements
I would like to thank the following people for their help and guidance that they 
have provided throughout my work on the package: 
Michel Lang, Lars Kotthoff, Martin Binder, Patrick Stratz, Bernd Bischl. 

